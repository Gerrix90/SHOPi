!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("inflected"),require("cuid"),require("fetch-everywhere"),require("es6-promise")):"function"==typeof define&&define.amd?define(["exports","inflected","cuid","fetch-everywhere","es6-promise"],e):e(t.moltin={},t.inflected,t.cuid)}(this,function(t,e,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var o=function(){if("undefined"==typeof localStorage||null===localStorage){var t=require("node-localstorage").LocalStorage;this.localStorage=new t("./localStorage")}else this.localStorage=window.localStorage};function r(t,n){var o=[];if(null===n||0===n.length)return o;if("string"==typeof n){var r={type:e.underscore(t),id:n};return"main-image"===t?r:[r]}return Array.isArray(n)&&(o=n.map(function(n){return{type:e.underscore(t),id:n}})),o}function i(t){return"main-image"===t?t:e.pluralize(t)}function s(){var t=new o,e=n();return null!==t.get("mcart")?t.get("mcart"):(t.set("mcart",e),e)}function c(t){return 204===t.status?new Promise(function(e){e({status:t.status,ok:t.ok,json:"{}"})}):new Promise(function(e){return t.json().then(function(n){return e({status:t.status,ok:t.ok,json:n})})})}function u(t,e){return"limit"===t||"offset"===t?"page"+e:"filter"===t?t+"="+Object.keys(e).map(function(t){return function(t,e){return Object.keys(e).map(function(n){var o=e[n];return t+"("+n+","+o+")"}).join(":")}(t,e[t])}).join(":"):t+"="+e}function p(t,e){var n,o,r,i,s,c,p;return e.includes||e.sort||e.limit||e.offset||e.filter?t+"?"+(o=(n=e).includes,r=n.sort,i=n.limit,s=n.offset,c=n.filter,p={},o&&(p.include=o),r&&(p.sort="("+r+")"),i&&(p.limit="[limit]="+i),s&&(p.offset="[offset]="+s),c&&(p.filter=c),Object.keys(p).map(function(t){return u(t,p[t])}).join("&")):t}function a(t,e,n){void 0===e&&(e=null),void 0===n&&(n="cart_item");var o={type:n};return"cart_item"===n&&Object.assign(o,{id:t,quantity:parseInt(e,10)}),"promotion_item"===n&&Object.assign(o,{code:t}),o}o.prototype.set=function(t,e){return this.localStorage.setItem(t,e)},o.prototype.get=function(t){return this.localStorage.getItem(t)},o.prototype.delete=function(t){return this.localStorage.removeItem(t)};var h=function(t,e,n){this.client_id=t,this.access_token=e,this.expires=n};h.prototype.toObject=function(){return{client_id:this.client_id,access_token:this.access_token,expires:this.expires}};var d=function(t){this.config=t,this.storage=new o};d.prototype.authenticate=function(){var t=this.config,e=this.storage;if(!t.client_id)throw new Error("You must have a client_id set");if(!t.host)throw new Error("You have not specified an API host");var n={grant_type:t.client_secret?"client_credentials":"implicit",client_id:t.client_id};t.client_secret&&(n.client_secret=t.client_secret);var o=new Promise(function(e,o){fetch(t.protocol+"://"+t.host+"/"+t.auth.uri,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")}).then(c).then(function(t){t.ok&&e(t.json),o(t.json)}).catch(function(t){return o(t)})});return o.then(function(n){var o=new h(t.client_id,n.access_token,n.expires);e.set("moltinCredentials",JSON.stringify(o))}),o},d.prototype.send=function(t,e,n,o){var r=this;void 0===n&&(n=void 0),void 0===o&&(o=void 0);var i=this.config,s=this.storage;return new Promise(function(u,p){var a=JSON.parse(s.get("moltinCredentials")),h=function(){var r={Authorization:"Bearer: "+a.access_token,"Content-Type":"application/json","X-MOLTIN-SDK-LANGUAGE":i.sdk.language,"X-MOLTIN-SDK-VERSION":i.sdk.version};i.application&&(r["X-MOLTIN-APPLICATION"]=i.application),i.currency&&(r["X-MOLTIN-CURRENCY"]=i.currency),o&&(r["X-MOLTIN-CUSTOMER-TOKEN"]=o),fetch(i.protocol+"://"+i.host+"/"+i.version+"/"+t,{method:e.toUpperCase(),headers:r,body:function(t){var e;return t&&(e='{\n      "data": '+JSON.stringify(t)+"\n    }"),e}(n)}).then(c).then(function(t){t.ok&&u(t.json),p(t.json)}).catch(function(t){return p(t)})};return!a||!a.access_token||a.client_id!==i.client_id||Math.floor(Date.now()/1e3)>=a.expires?r.authenticate().then(h).catch(function(t){return p(t)}):h()})};var l=function(t){this.request=new d(t),this.config=t};l.prototype.All=function(t){void 0===t&&(t=null);var e=this.includes,n=this.sort,o=this.limit,r=this.offset,i=this.filter;return this.call=this.request.send(p(this.endpoint,{includes:e,sort:n,limit:o,offset:r,filter:i}),"GET",void 0,t),this.call},l.prototype.Get=function(t,e){return void 0===e&&(e=null),this.call=this.request.send(p(this.endpoint+"/"+t,{includes:this.includes}),"GET",void 0,e),this.call},l.prototype.Filter=function(t){return this.filter=t,this},l.prototype.Limit=function(t){return this.limit=t,this},l.prototype.Offset=function(t){return this.offset=t,this},l.prototype.Sort=function(t){return this.sort=t,this},l.prototype.With=function(t){return t&&(this.includes=t.toString().toLowerCase()),this};var f=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.Create=function(t){return this.request.send(this.endpoint,"POST",Object.assign({},t,{type:e.singularize(this.endpoint)}))},n.prototype.Delete=function(t){return this.request.send(this.endpoint+"/"+t,"DELETE")},n.prototype.Update=function(t,n){return this.request.send(this.endpoint+"/"+t,"PUT",Object.assign({},n,{type:e.singularize(this.endpoint)}))},n}(l),y=function(t){function e(e){t.call(this,e),this.endpoint="products"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.CreateRelationships=function(t,e,n){var o=r(e,n),s=i(e);return this.request.send(this.endpoint+"/"+t+"/relationships/"+s,"POST",o)},e.prototype.DeleteRelationships=function(t,e,n){var o=r(e,n),s=i(e);return this.request.send(this.endpoint+"/"+t+"/relationships/"+s,"DELETE",o)},e.prototype.UpdateRelationships=function(t,e,n){void 0===n&&(n=null);var o=r(e,n),s=i(e);return this.request.send(this.endpoint+"/"+t+"/relationships/"+s,"PUT",o)},e}(f),m=function(t){function e(e){t.call(this,e),this.endpoint="currencies",this.storage=new o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Create=function(t){return this.request.send(""+this.endpoint,"POST",t)},e.prototype.Delete=function(t){return this.request.send(this.endpoint+"/"+t,"DELETE")},e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e.prototype.Set=function(t){var e=this.config,n=this.storage;return n.set("mcurrency",t),e.currency=t,new Promise(function(t,e){var o=n.get("mcurrency");try{t(o)}catch(t){e(new Error(t))}})},e.prototype.Active=function(){var t=this.storage;return new Promise(function(e,n){var o=t.get("mcurrency");try{e(o)}catch(t){n(new Error(t))}})},e}(l),_=function(t){function e(e){t.call(this,e),this.endpoint="brands"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(f),v=function(t){function e(e,n){t.apply(this,arguments),this.request=e,this.cartId=n,this.endpoint="carts"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Get=function(){return this.request.send(this.endpoint+"/"+this.cartId,"GET")},e.prototype.Items=function(){return this.request.send(this.endpoint+"/"+this.cartId+"/items","GET")},e.prototype.AddProduct=function(t,e){void 0===e&&(e=1);var n=a(t,e);return this.request.send(this.endpoint+"/"+this.cartId+"/items","POST",n)},e.prototype.AddCustomItem=function(t){var e=Object.assign(t,{type:"custom_item"});return this.request.send(this.endpoint+"/"+this.cartId+"/items","POST",e)},e.prototype.AddPromotion=function(t){var e=a(t,null,"promotion_item");return this.request.send(this.endpoint+"/"+this.cartId+"/items","POST",e)},e.prototype.RemoveItem=function(t){return this.request.send(this.endpoint+"/"+this.cartId+"/items/"+t,"DELETE")},e.prototype.UpdateItemQuantity=function(t,e){var n=a(t,e);return this.request.send(this.endpoint+"/"+this.cartId+"/items/"+t,"PUT",n)},e.prototype.Checkout=function(t,e,n){void 0===n&&(n=e);var o=function(t,e,n){var o=t;return"string"==typeof t&&(o={id:t}),{customer:o,billing_address:e,shipping_address:n}}(t,e,n);return this.request.send(this.endpoint+"/"+this.cartId+"/checkout","POST",o)},e.prototype.Delete=function(){return this.request.send(this.endpoint+"/"+this.cartId,"DELETE")},e}(l),g=function(t){function e(e){t.call(this,e),this.endpoint="categories"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Tree=function(){return this.request.send(this.endpoint+"/tree","GET")},e}(f),O=function(t){function e(e){t.call(this,e),this.endpoint="collections"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(f),q=function(t){function e(e){t.call(this,e),this.endpoint="orders"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Items=function(t){return this.request.send(this.endpoint+"/"+t+"/items","GET")},e.prototype.Payment=function(t,e){return this.request.send(this.endpoint+"/"+t+"/payments","POST",e)},e.prototype.Transactions=function(t){return this.request.send(this.endpoint+"/"+t+"/transactions","GET")},e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",Object.assign({},e,{type:"order"}))},e}(l),T=function(t){function e(e){t.call(this,e),this.endpoint="gateways"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Update=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",e)},e.prototype.Enabled=function(t,e){return this.request.send(this.endpoint+"/"+t,"PUT",{type:"gateway",enabled:e})},e}(l),w=function(t){function e(e){t.call(this,e),this.endpoint="customers"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Token=function(t,e){return this.request.send(this.endpoint+"/tokens","POST",{email:t,password:e,type:"token"})},e}(f),E=function(t){function e(e){t.call(this,e),this.endpoint="inventories"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.Get=function(t){return this.request.send(this.endpoint+"/"+t,"GET")},e.prototype.IncrementStock=function(t,e){return this.request.send(this.endpoint+"/"+t+"/transactions","POST",{action:"increment",quantity:e,type:"stock-transaction"})},e.prototype.DecrementStock=function(t,e){return this.request.send(this.endpoint+"/"+t+"/transactions","POST",{action:"decrement",quantity:e,type:"stock-transaction"})},e.prototype.AllocateStock=function(t,e){return this.request.send(this.endpoint+"/"+t+"/transactions","POST",{action:"allocate",quantity:e,type:"stock-transaction"})},e.prototype.DeallocateStock=function(t,e){return this.request.send(this.endpoint+"/"+t+"/transactions","POST",{action:"deallocate",quantity:e,type:"stock-transaction"})},e.prototype.GetTransactions=function(t){return this.request.send(this.endpoint+"/"+t+"/transactions","GET")},e}(l),j=function(t){function e(e){t.call(this,e),this.endpoint="flows"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.GetEntries=function(t){return this.request.send(this.endpoint+"/"+t+"/entries","GET")},e.prototype.GetEntry=function(t,e){return this.request.send(this.endpoint+"/"+t+"/entries/"+e,"GET")},e.prototype.CreateEntry=function(t,e){return this.request.send(this.endpoint+"/"+t+"/entries","POST",Object.assign({},e,{type:"entry"}))},e.prototype.UpdateEntry=function(t,e,n){return this.request.send(this.endpoint+"/"+t+"/entries/"+e,"PUT",Object.assign({},n,{type:"entry"}))},e.prototype.DeleteEntry=function(t,e){return this.request.send(this.endpoint+"/"+t+"/entries/"+e,"DELETE")},e}(f),S=function(t){function e(e){t.call(this,e),this.endpoint="fields"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(f),P=function(t){function n(e){t.call(this,e),this.endpoint="addresses"}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.All=function(t){var e=t.customer,n=t.token;return void 0===n&&(n=null),this.request.send("customers/"+e+"/"+this.endpoint,"GET",void 0,n)},n.prototype.Get=function(t){var e=t.customer,n=t.address,o=t.token;return void 0===o&&(o=null),this.request.send("customers/"+e+"/"+this.endpoint+"/"+n,"GET",void 0,o)},n.prototype.Create=function(t){var n=t.customer,o=t.body,r=t.token;return void 0===r&&(r=null),this.request.send("customers/"+n+"/"+this.endpoint,"POST",Object.assign({},o,{type:e.singularize(this.endpoint)}),r)},n.prototype.Delete=function(t){var e=t.customer,n=t.address,o=t.token;return void 0===o&&(o=null),this.request.send("customers/"+e+"/"+this.endpoint+"/"+n,"DELETE",void 0,o)},n.prototype.Update=function(t){var n=t.customer,o=t.address,r=t.body,i=t.token;return void 0===i&&(i=null),this.request.send("customers/"+n+"/"+this.endpoint+"/"+o,"PUT",Object.assign({},r,{type:e.singularize(this.endpoint)}),i)},n}(l),b=function(t){this.config=t,this.cartId=s(),this.request=new d(t),this.storage=new o,this.Products=new y(t),this.Currencies=new m(t),this.Brands=new _(t),this.Categories=new g(t),this.Collections=new O(t),this.Orders=new q(t),this.Gateways=new T(t),this.Customers=new w(t),this.Inventories=new E(t),this.Flows=new j(t),this.Fields=new S(t),this.Addresses=new P(t)};b.prototype.Cart=function(t){return void 0===t&&(t=this.cartId),new v(this.request,t)},b.prototype.Authenticate=function(){return this.request.authenticate()};t.default=b,t.gateway=function(t){return new b(new function(t){var e=t.application,n=t.client_id,o=t.client_secret,r=t.currency,i=t.host;this.application=e,this.client_id=n,this.client_secret=o,this.host=i||"api.moltin.com",this.protocol="https",this.version="v2",this.currency=r,this.auth={expires:3600,uri:"oauth/access_token"},this.sdk={version:"0.0.0-semantic-release",language:"JS"}}(t))},Object.defineProperty(t,"__esModule",{value:!0})});
